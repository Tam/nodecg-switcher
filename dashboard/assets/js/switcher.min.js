!function(e){"use strict";function t(){var e=n.getElementsByTagName("nav")[0],t=e.getElementsByTagName("a");[].slice.call(t).forEach(function(t){t.addEventListener("click",function(n){if(n.preventDefault(),!t.classList.contains("active")){var i=e.getElementsByClassName("active")[0];switch(i&&i.classList.remove("active"),t.classList.add("active"),t.getAttribute("data-s")){case"vmix":r.terminate(),o.init();break;case"obs":o.terminate(),r.init()}}})})}var n=document.getElementById("panelSwitcher"),i=e.top.document.getElementById("nodecg-switcher_switcherSettings"),s={el:document.getElementById("scenes"),clear:function(){this.el.innerHTML=""},append:function(e){this.el.appendChild(e)},active:function(){return this.el.getElementsByClassName("active")[0]}},a={el:n.getElementsByClassName("error")[0],isVisible:!1,name:"",show:function(){var e=this;return this.el.classList.contains("visible")?(this.hide(),setTimeout(function(){e.el.classList.add("visible")},250)):this.el.classList.add("visible"),setTimeout(function(){e.hide()},1e4),console.error("[Switcher]",this.el.innerText),this.isVisible=!0,this},hide:function(){return this.el.classList.remove("visible"),this.isVisible=!1,this.name="",this},set:function(e,t){var n=this;return this.el.innerText=e,t&&(this.name=t),this.el.addEventListener("click",function(){n.hide()}),this}},c={get:function(e,t,n){var i=new XMLHttpRequest;i.onload=function(){i.status>=200&&i.status<400&&(t?t(i.responseText):n&&n())},i.onerror=function(){n&&n()},i.open("GET",e,!0),i.send()},parseXML:function(t){function n(e){var t={};if(e.childElementCount)for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i],a=s.nodeName;t.hasOwnProperty(a)&&(a=a+"_"+i),t[a]=n(s)}else e.innerHTML&&(t.text=e.innerHTML);if(e.attributes&&e.attributes.length)for(var c in e.attributes)if(e.attributes.hasOwnProperty(c)){var o=e.attributes[c].nodeName,r=c;t.hasOwnProperty(o)&&(o+="_attr"),t[o]=e.attributes[r].value}return t}var i=(new e.DOMParser).parseFromString(t,"text/xml").documentElement;return n(i)},addPlaceholders:function(e){for(var t=e>0?e%4:4,n=document.createElement("span"),i=0;t>i;i++)s.append(n.cloneNode(!1))}},o={scenes:{},activeScene:"",apiUrl:"192.168.0.6:8088",isInitialized:!1,hasConnection:!1,activeTimeout:null,api:function(e,t,n){var i="";if(e&&e!=={}){for(var s in e)e.hasOwnProperty(s)&&(""!==i&&(i+="&"),i+=s+"="+encodeURIComponent(e[s]));i="?"+i}c.get("http://"+o.apiUrl+"/api/"+i,t,function(){o.hasConnection=!1,n()})},checkConnection:function(){o.api(null,function(){o.hasConnection=!0,"vMixConnectionError"===a.name&&a.hide(),o.loop()},function(){o.hasConnection=!1,o.isInitialized&&(o.activeTimeout=setTimeout(o.checkConnection,5e3))})},switchScenes:function(e,t){e!==o.activeScene&&o.api({Function:"Cut",Input:e},function(){var n=s.active();n&&n.classList.remove("active"),t.classList.add("active"),o.activeScene=e},function(){"vMixSceneSwitchError"!==a.name&&a.set("Unable to switch scenes!","vMixSceneSwitchError").show()})},updateScenes:function(){this.api(null,function(e){var t=c.parseXML(e),n=t.inputs,i=parseInt(t.active.text),a="",r={};for(a in n)n.hasOwnProperty(a)&&(r[a]=n[a]);if(JSON.stringify(r)!==JSON.stringify(o.scenes)||n[Object.keys(n)[i-1]].key!==o.activeScene){o.scenes=r;var l=document.createElement("a"),u=0;l.setAttribute("href","#");var d=function(e,t){e.addEventListener("click",function(n){n.preventDefault(),o.switchScenes(t,e)},!0)};s.clear();var h=0;for(a in n)if(n.hasOwnProperty(a)){h++;var v=n[a],f=l.cloneNode(!0);f.setAttribute("data-id",v.key),f.innerText=v.title,d(f,v.key),h===i&&(f.classList.add("active"),o.activeScene=v.key),s.append(f),u++}c.addPlaceholders(u)}},function(){s.clear(),c.addPlaceholders(0),"vMixSceneUpdateError"!==a.name&&o.hasConnection&&a.set("Unable to update vMix scenes!","vMixSceneUpdateError").show()})},loop:function(e){o.isInitialized&&(o.hasConnection?(o.updateScenes(),o.activeTimeout=setTimeout(o.loop,1e3)):(o.checkConnection(),"vMixConnectionError"===a.name||e||a.set("Unable to connect to vMix!","vMixConnectionError").show()))},init:function(){this.isInitialized=!0,this.checkConnection(),this.loop(!0)},terminate:function(){this.isInitialized=!1,this.scenes={},this.activeScene="",clearTimeout(o.activeTimeout),a.hide()}},r={isInitialized:!0,init:function(){this.isInitialized=!0,s.clear(),c.addPlaceholders(0)},terminate:function(){this.isInitialized=!1,a.hide()}},l={el:e.top.document.getElementById("nodecg-switcher_switcher"),init:function(){var t=e.top.document.createElement("paper-icon-button");t.icon="settings",t.addEventListener("click",function(){i.open()});var n=this.el.querySelector("paper-icon-button#infoBtn");n.parentNode.insertBefore(t,n)}};l.init(),t(),o.init()}(window);