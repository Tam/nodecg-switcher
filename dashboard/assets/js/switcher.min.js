!function(e){"use strict";function t(){var e=i.getElementsByTagName("nav")[0],t=e.getElementsByTagName("a");[].slice.call(t).forEach(function(t){t.addEventListener("click",function(i){if(i.preventDefault(),!t.classList.contains("active")){var n=e.getElementsByClassName("active")[0];switch(n&&n.classList.remove("active"),t.classList.add("active"),t.getAttribute("data-s")){case"vmix":o.terminate(),c.init();break;case"obs":c.terminate(),o.init()}}})})}var i=document.getElementById("panelSwitcher"),n={el:document.getElementById("scenes"),clear:function(){this.el.innerHTML=""},append:function(e){this.el.appendChild(e)},active:function(){return this.el.getElementsByClassName("active")[0]}},s={el:i.getElementsByClassName("error")[0],isVisible:!1,name:"",show:function(){var e=this;return this.el.classList.contains("visible")?(this.hide(),setTimeout(function(){e.el.classList.add("visible")},250)):this.el.classList.add("visible"),setTimeout(function(){e.hide()},1e4),console.error("[Switcher]",this.el.innerText),this.isVisible=!0,this},hide:function(){return this.el.classList.remove("visible"),this.isVisible=!1,this.name="",this},set:function(e,t){var i=this;return this.el.innerText=e,t&&(this.name=t),this.el.addEventListener("click",function(){i.hide()}),this}},a={get:function(e,t,i){var n=new XMLHttpRequest;n.onload=function(){n.status>=200&&n.status<400&&(t?t(n.responseText):i&&i())},n.onerror=function(){i&&i()},n.open("GET",e,!0),n.send()},parseXML:function(t){function i(e){var t={};if(e.childElementCount)for(var n=0;n<e.childNodes.length;n++){var s=e.childNodes[n],a=s.nodeName;t.hasOwnProperty(a)&&(a=a+"_"+n),t[a]=i(s)}else e.innerHTML&&(t.text=e.innerHTML);if(e.attributes&&e.attributes.length)for(var c in e.attributes)if(e.attributes.hasOwnProperty(c)){var o=e.attributes[c].nodeName,r=c;t.hasOwnProperty(o)&&(o+="_attr"),t[o]=e.attributes[r].value}return t}var n=(new e.DOMParser).parseFromString(t,"text/xml").documentElement;return i(n)},addPlaceholders:function(e){for(var t=e>0?e%4:4,i=document.createElement("span"),s=0;t>s;s++)n.append(i.cloneNode(!1))}},c={scenes:{},activeScene:"",apiUrl:"127.0.0.1:8088",isInitialized:!1,hasConnection:!1,activeTimeout:null,api:function(e,t,i){var n="";if(e&&e!=={}){for(var s in e)e.hasOwnProperty(s)&&(""!==n&&(n+="&"),n+=s+"="+encodeURIComponent(e[s]));n="?"+n}a.get("http://"+c.apiUrl+"/api/"+n,t,function(){c.hasConnection=!1,i()})},checkConnection:function(){c.api(null,function(){c.hasConnection=!0,"vMixConnectionError"===s.name&&s.hide(),c.loop()},function(){c.hasConnection=!1,c.isInitialized&&(c.activeTimeout=setTimeout(c.checkConnection,5e3))})},switchScenes:function(e,t){e!==c.activeScene&&c.api({Function:"Cut",Input:e},function(){var i=n.active();i&&i.classList.remove("active"),t.classList.add("active"),c.activeScene=e},function(){"vMixSceneSwitchError"!==s.name&&s.set("Unable to switch scenes!","vMixSceneSwitchError").show()})},updateScenes:function(){this.api(null,function(e){var t=a.parseXML(e),i=t.inputs,s=parseInt(t.active.text),o="",r={};for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);if(JSON.stringify(r)!==JSON.stringify(c.scenes)||i[Object.keys(i)[s-1]].key!==c.activeScene){c.scenes=r;var l=document.createElement("a"),u=0;l.setAttribute("href","#");var d=function(e,t){e.addEventListener("click",function(i){i.preventDefault(),c.switchScenes(t,e)},!0)};n.clear();var h=0;for(o in i)if(i.hasOwnProperty(o)){h++;var v=i[o],f=l.cloneNode(!0);f.setAttribute("data-id",v.key),f.innerText=v.title,d(f,v.key),h===s&&(f.classList.add("active"),c.activeScene=v.key),n.append(f),u++}a.addPlaceholders(u)}},function(){n.clear(),a.addPlaceholders(0),"vMixSceneUpdateError"!==s.name&&c.hasConnection&&s.set("Unable to update vMix scenes!","vMixSceneUpdateError").show()})},loop:function(){c.isInitialized&&(c.hasConnection?(c.updateScenes(),c.activeTimeout=setTimeout(c.loop,1e3)):(c.checkConnection(),"vMixConnectionError"!==s.name&&s.set("Unable to connect to vMix!","vMixConnectionError").show()))},init:function(){this.isInitialized=!0,this.checkConnection(),this.loop()},terminate:function(){this.isInitialized=!1,this.scenes={},this.activeScene="",clearTimeout(c.activeTimeout),s.hide()}},o={isInitialized:!0,init:function(){this.isInitialized=!0,n.clear(),a.addPlaceholders(0)},terminate:function(){this.isInitialized=!1,s.hide()}};t(),c.init()}(window);