!function(e){"use strict";function t(){u.init(),c.set("No software enabled, please check settings!").show(-1),d.addItem("vmix","vMix",function(){d.items.vmix.setActive(),r.init(),l.terminate()}),d.addItem("obs","OBS",function(){d.items.obs.setActive(),r.terminate(),l.init()}),d.items.obs.setActive()}function n(){a.get("settings_modal.html",function(t){t=t.replace(/(\r\n|\n|\r)/gm,"");var n=new DOMParser,i=n.parseFromString(t,"text/html"),s=i.body.firstChild;e.top.document.body.appendChild(s)})}var i=document.getElementById("panelSwitcher"),s=e.top.document.getElementById("nodecg-switcher_switcherSettings"),o={el:document.getElementById("scenes"),clear:function(){this.el.innerHTML=""},append:function(e){this.el.appendChild(e)},active:function(){return this.el.getElementsByClassName("active")[0]}},c={el:i.getElementsByClassName("error")[0],isVisible:!1,name:"",show:function(e){var t=this;return e=e||1e4,this.el.classList.contains("visible")?(this.hide(),setTimeout(function(){t.el.classList.add("visible")},250)):this.el.classList.add("visible"),-1!==e&&setTimeout(function(){t.hide()},e),console.error("[Switcher]",this.el.innerText),this.isVisible=!0,this},hide:function(){return this.el.classList.remove("visible"),this.isVisible=!1,this.name="",this},set:function(e,t){var n=this;return this.el.innerText=e,t&&(this.name=t),this.el.addEventListener("click",function(){n.hide()}),this}},a={get:function(e,t,n){var i=new XMLHttpRequest;i.onload=function(){i.status>=200&&i.status<400&&(t?t(i.responseText):n&&n())},i.onerror=function(){n&&n()},i.open("GET",e,!0),i.send()},parseXML:function(t){function n(e){var t={};if(e.childElementCount)for(var i=0;i<e.childNodes.length;i++){var s=e.childNodes[i],o=s.nodeName;t.hasOwnProperty(o)&&(o=o+"_"+i),t[o]=n(s)}else e.innerHTML&&(t.text=e.innerHTML);if(e.attributes&&e.attributes.length)for(var c in e.attributes)if(e.attributes.hasOwnProperty(c)){var a=e.attributes[c].nodeName,r=c;t.hasOwnProperty(a)&&(a+="_attr"),t[a]=e.attributes[r].value}return t}var i=(new e.DOMParser).parseFromString(t,"text/xml").documentElement;return n(i)},addPlaceholders:function(e){for(var t=e>0?e%4:4,n=document.createElement("span"),i=0;t>i;i++)o.append(n.cloneNode(!1))}},r={scenes:{},activeScene:"",apiUrl:"192.168.0.6:8088",isInitialized:!1,hasConnection:!1,activeTimeout:null,api:function(e,t,n){var i="";if(e&&e!=={}){for(var s in e)e.hasOwnProperty(s)&&(""!==i&&(i+="&"),i+=s+"="+encodeURIComponent(e[s]));i="?"+i}a.get("http://"+r.apiUrl+"/api/"+i,t,function(){r.hasConnection=!1,n()})},checkConnection:function(){r.api(null,function(){r.hasConnection=!0,"vMixConnectionError"===c.name&&c.hide(),r.loop()},function(){r.hasConnection=!1,r.isInitialized&&(r.activeTimeout=setTimeout(r.checkConnection,5e3))})},switchScenes:function(e,t){e!==r.activeScene&&r.api({Function:"Cut",Input:e},function(){var n=o.active();n&&n.classList.remove("active"),t.classList.add("active"),r.activeScene=e},function(){"vMixSceneSwitchError"!==c.name&&c.set("Unable to switch scenes!","vMixSceneSwitchError").show()})},updateScenes:function(){this.api(null,function(e){var t=a.parseXML(e),n=t.inputs,i=parseInt(t.active.text),s="",c={};for(s in n)n.hasOwnProperty(s)&&(c[s]=n[s]);if(JSON.stringify(c)!==JSON.stringify(r.scenes)||n[Object.keys(n)[i-1]].key!==r.activeScene){r.scenes=c;var l=document.createElement("a"),d=0;l.setAttribute("href","#");var u=function(e,t){e.addEventListener("click",function(n){n.preventDefault(),r.switchScenes(t,e)},!0)};o.clear();var h=0;for(s in n)if(n.hasOwnProperty(s)){h++;var v=n[s],m=l.cloneNode(!0);m.setAttribute("data-id",v.key),m.innerText=v.title,u(m,v.key),h===i&&(m.classList.add("active"),r.activeScene=v.key),o.append(m),d++}a.addPlaceholders(d)}},function(){o.clear(),a.addPlaceholders(0),"vMixSceneUpdateError"!==c.name&&r.hasConnection&&c.set("Unable to update vMix scenes!","vMixSceneUpdateError").show()})},loop:function(){r.isInitialized&&(r.hasConnection?(r.updateScenes(),r.activeTimeout=setTimeout(r.loop,1e3)):(r.checkConnection(),o.clear(),a.addPlaceholders(0),console.log(c),"vMixConnectionError"!==c.name&&c.set("Unable to connect to vMix!","vMixConnectionError").show()))},init:function(){this.isInitialized=!0,this.checkConnection(),this.loop()},terminate:function(){this.isInitialized=!1,this.scenes={},this.activeScene="",clearTimeout(r.activeTimeout),c.hide()}},l={isInitialized:!0,init:function(){this.isInitialized=!0,o.clear(),a.addPlaceholders(0)},terminate:function(){this.isInitialized=!1,c.hide()}},d={el:i.getElementsByTagName("nav")[0],items:{},addItem:function(e,t,n){var i=document.createElement("a");i.setAttribute("href","#"),i.innerText=t,i.addEventListener("click",function(e){e.preventDefault(),n()}),i.setActive=function(){var e=d.el.getElementsByClassName("active")[0];e&&e.classList.remove("active"),this.classList.add("active")},this.items[e]=i,this.el.appendChild(i)}},u={el:e.top.document.getElementById("nodecg-switcher_switcher"),init:function(){var t=e.top.document.createElement("paper-icon-button");t.icon="settings",t.addEventListener("click",function(){s.open()});var n=this.el.querySelector("paper-icon-button#infoBtn");n.parentNode.insertBefore(t,n)}};t(),n()}(window);