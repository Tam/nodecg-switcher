!function(e){"use strict";function t(){d.init(),c.set("No software enabled, please check settings!").show(-1),l.addItem("vmix","vMix",function(){l.items.vmix.setActive(),a.init(),r.terminate()}),l.addItem("obs","OBS",function(){l.items.obs.setActive(),a.terminate(),r.init()}),l.items.obs.setActive()}var i=document.getElementById("panelSwitcher"),n=e.top.document.getElementById("nodecg-switcher_switcherSettings"),s={el:document.getElementById("scenes"),clear:function(){this.el.innerHTML=""},append:function(e){this.el.appendChild(e)},active:function(){return this.el.getElementsByClassName("active")[0]}},c={el:i.getElementsByClassName("error")[0],isVisible:!1,name:"",show:function(e){var t=this;return e=e||1e4,this.el.classList.contains("visible")?(this.hide(),setTimeout(function(){t.el.classList.add("visible")},250)):this.el.classList.add("visible"),-1!==e&&setTimeout(function(){t.hide()},e),console.error("[Switcher]",this.el.innerText),this.isVisible=!0,this},hide:function(){return this.el.classList.remove("visible"),this.isVisible=!1,this.name="",this},set:function(e,t){var i=this;return this.el.innerText=e,t&&(this.name=t),this.el.addEventListener("click",function(){i.hide()}),this}},o={get:function(e,t,i){var n=new XMLHttpRequest;n.onload=function(){n.status>=200&&n.status<400&&(t?t(n.responseText):i&&i())},n.onerror=function(){i&&i()},n.open("GET",e,!0),n.send()},parseXML:function(t){function i(e){var t={};if(e.childElementCount)for(var n=0;n<e.childNodes.length;n++){var s=e.childNodes[n],c=s.nodeName;t.hasOwnProperty(c)&&(c=c+"_"+n),t[c]=i(s)}else e.innerHTML&&(t.text=e.innerHTML);if(e.attributes&&e.attributes.length)for(var o in e.attributes)if(e.attributes.hasOwnProperty(o)){var a=e.attributes[o].nodeName,r=o;t.hasOwnProperty(a)&&(a+="_attr"),t[a]=e.attributes[r].value}return t}var n=(new e.DOMParser).parseFromString(t,"text/xml").documentElement;return i(n)},addPlaceholders:function(e){for(var t=e>0?e%4:4,i=document.createElement("span"),n=0;t>n;n++)s.append(i.cloneNode(!1))}},a={scenes:{},activeScene:"",apiUrl:"192.168.0.6:8088",isInitialized:!1,hasConnection:!1,activeTimeout:null,api:function(e,t,i){var n="";if(e&&e!=={}){for(var s in e)e.hasOwnProperty(s)&&(""!==n&&(n+="&"),n+=s+"="+encodeURIComponent(e[s]));n="?"+n}o.get("http://"+a.apiUrl+"/api/"+n,t,function(){a.hasConnection=!1,i()})},checkConnection:function(){a.api(null,function(){a.hasConnection=!0,"vMixConnectionError"===c.name&&c.hide(),a.loop()},function(){a.hasConnection=!1,a.isInitialized&&(a.activeTimeout=setTimeout(a.checkConnection,5e3))})},switchScenes:function(e,t){e!==a.activeScene&&a.api({Function:"Cut",Input:e},function(){var i=s.active();i&&i.classList.remove("active"),t.classList.add("active"),a.activeScene=e},function(){"vMixSceneSwitchError"!==c.name&&c.set("Unable to switch scenes!","vMixSceneSwitchError").show()})},updateScenes:function(){this.api(null,function(e){var t=o.parseXML(e),i=t.inputs,n=parseInt(t.active.text),c="",r={};for(c in i)i.hasOwnProperty(c)&&(r[c]=i[c]);if(JSON.stringify(r)!==JSON.stringify(a.scenes)||i[Object.keys(i)[n-1]].key!==a.activeScene){a.scenes=r;var l=document.createElement("a"),d=0;l.setAttribute("href","#");var u=function(e,t){e.addEventListener("click",function(i){i.preventDefault(),a.switchScenes(t,e)},!0)};s.clear();var h=0;for(c in i)if(i.hasOwnProperty(c)){h++;var v=i[c],m=l.cloneNode(!0);m.setAttribute("data-id",v.key),m.innerText=v.title,u(m,v.key),h===n&&(m.classList.add("active"),a.activeScene=v.key),s.append(m),d++}o.addPlaceholders(d)}},function(){s.clear(),o.addPlaceholders(0),"vMixSceneUpdateError"!==c.name&&a.hasConnection&&c.set("Unable to update vMix scenes!","vMixSceneUpdateError").show()})},loop:function(){a.isInitialized&&(a.hasConnection?(a.updateScenes(),a.activeTimeout=setTimeout(a.loop,1e3)):(a.checkConnection(),s.clear(),o.addPlaceholders(0),console.log(c),"vMixConnectionError"!==c.name&&c.set("Unable to connect to vMix!","vMixConnectionError").show()))},init:function(){this.isInitialized=!0,this.checkConnection(),this.loop()},terminate:function(){this.isInitialized=!1,this.scenes={},this.activeScene="",clearTimeout(a.activeTimeout),c.hide()}},r={isInitialized:!0,init:function(){this.isInitialized=!0,s.clear(),o.addPlaceholders(0)},terminate:function(){this.isInitialized=!1,c.hide()}},l={el:i.getElementsByTagName("nav")[0],items:{},addItem:function(e,t,i){var n=document.createElement("a");n.setAttribute("href","#"),n.innerText=t,n.addEventListener("click",function(e){e.preventDefault(),i()}),n.setActive=function(){var e=l.el.getElementsByClassName("active")[0];e&&e.classList.remove("active"),this.classList.add("active")},this.items[e]=n,this.el.appendChild(n)}},d={el:e.top.document.getElementById("nodecg-switcher_switcher"),init:function(){var t=e.top.document.createElement("paper-icon-button");t.icon="settings",t.addEventListener("click",function(){n.open()});var i=this.el.querySelector("paper-icon-button#infoBtn");i.parentNode.insertBefore(t,i)}};t()}(window);